---
title: "Répartition des activités agricoles et d’élevage au Sénégal"
author: "Kadidja GUEBEDIANG A NKEN--Isep2 "
date: "Année académique 2024-2025"
output:
  beamer_presentation:
    theme: "CambridgeUS"
    colortheme: "dolphin"
    toc: false
    slide_level: 2
---


```{r setup, include=FALSE}
# setup
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r libraries}
library(sf)
library(haven)
library(dplyr)
library(tidyr)
library(tmap)
library(ggplot2)
library(patchwork)
```


```{r import}
# Chemins d'accès (à adapter selon votre configuration)
data_path <- "C:/Users/LENOVO/Desktop/second semestre/ISEP2025/ISEP2025/projet_cartographie_Shiny/"

# Chargement des fichiers
s16a <- read_dta(paste0(data_path, "s16a_me_SEN2018.dta")) # Données agricoles
s16b <- read_dta(paste0(data_path, "s16b_me_SEN2018.dta")) 
s17  <- read_dta(paste0(data_path, "s17_me_SEN2018.dta"))  # Données élevage
s00  <- read_dta(paste0(data_path, "s00_me_SEN2018.dta"))  # Données géographiques


```



```{r nettoyage}
s00 <- s00 %>%
  rename(region = s00q01, departement = s00q02, milieu = s00q04) %>%
  select(grappe, menage, region, departement, milieu)

s16a <- s16a %>%
  rename(culture = s16aq08, superficie = s16aq09a)

s17 <- s17 %>%
  rename(espece = s17q02, nb_animaux = s17q05)
```


```{r aggregation}
agriculture <- s16a %>%
  group_by(grappe, menage) %>%
  summarise(nb_parcelles = n(), .groups = "drop")

elevage <- s17 %>%
  group_by(grappe, menage) %>%
  summarise(nb_animaux = sum(nb_animaux, na.rm = TRUE), .groups = "drop")

merged_data <- full_join(agriculture, elevage, by = c("grappe", "menage"))
merged_geo <- left_join(merged_data, s00, by = c("grappe", "menage"))

merged_geo <- merged_geo %>%
  mutate(nb_parcelles = replace_na(nb_parcelles, 0),
         nb_animaux = replace_na(nb_animaux, 0))
```


```{r region-summary}
region_data <- merged_geo %>%
  group_by(region) %>%
  summarise(
    total_parcelles = sum(nb_parcelles, na.rm = TRUE),
    total_animaux = sum(nb_animaux, na.rm = TRUE)
  )

region_data <- region_data %>% mutate(region = toupper(region))

correspondance <- data.frame(
  region = as.character(1:14),
  NOMREG = c("DAKAR", "ZIGUINCHOR", "DIOURBEL", "SAINT LOUIS", "TAMBACOUNDA",
             "KAOLACK", "THIES", "LOUGA", "FATICK", "KOLDA",
             "MATAM", "KAFFRINE", "KEDOUGOU", "SEDHIOU")
)

region_data <- left_join(region_data, correspondance, by = "region")
```





```{r map,include=TRUE}
#sen_map <- st_read("C:/Users/LENOVO/Desktop/second semestre/ISEP2025/ISEP2025/projet_cartographie_Shiny/Limite_Région.shp")
#map_data <- left_join(sen_map, region_data, by = "NOMREG")
#library(sf)
#sen_map <- suppressWarnings(
  #suppressMessages(
    #st_read("C:/Users/LENOVO/Desktop/second semestre/ISEP2025/ISEP2025/projet_cartographie_Shiny/Limite_Région.shp", quiet = TRUE)
 # )
#)

sen_map <- suppressWarnings(
  suppressMessages(
    sen_map <- st_read(paste0(data_path, "Limite_Région.shp"), quiet = TRUE)
  )
)

map_data <- left_join(sen_map, region_data, by = "NOMREG")
```


# **Introduction**

    Objectif : visualiser la répartition spatiale des activités  
    agricoles et pastorales au Sénégal.    

    Données : enquête EHCVM 2018.  

    Approche : agrégation des données par ménage et croisement  
    avec les données géographiques des régions.    

    Outils : ggplot2, tmap, sf.  
    

    
# **Visualisation des activités agricoles**

## Objectif

    Identifier les zones à forte activité agricole  

    Observer la répartition régionale du nombre de parcelles  

    Comprendre le statut d’occupation des terres
    


# **Carte des activités agricoles**

```{r}
map_data <- map_data %>%
  mutate(label_cheptel = paste0(NOMREG, "\n", round(total_animaux, 1)))

# Carte des parcelles agricoles

tmap_mode("plot")

tm_shape(map_data) +
  tm_polygons("total_parcelles", palette = "Greens", title = "Parcelles agricoles") +
  tm_text("NOMREG", size = 0.6, col = "black", just = "left") +
  tm_text("total_parcelles", size = 0.6, col = "black", ymod = -1.0) +
  tm_title("Distribution des activités agricoles par région") +
  tm_layout(legend.outside = TRUE)
```


# **Nombre moyen de parcelles par ménage**

```{r}
cat("Le nombre moyen national de parcelles \n par ménage est de", 
    round(mean(merged_geo$nb_parcelles, na.rm = TRUE), 2), "parcelles.\n")

moyenne_par_region <- merged_geo %>%
  group_by(region) %>%
  summarise(moyenne_parcelles = mean(nb_parcelles, na.rm = TRUE)) %>%
  mutate(region = as.character(region)) %>%
  left_join(correspondance, by = "region")

ggplot(moyenne_par_region, aes(x = reorder(NOMREG, moyenne_parcelles), y = moyenne_parcelles)) +
  geom_col(fill = "forestgreen") +
  geom_text(aes(label = round(moyenne_parcelles, 1)), vjust = -0.3, size = 3) +
  coord_flip() +
  labs(title = "Nombre moyen de parcelles par ménage",
       x = "Région", y = "Moyenne de parcelles") +
  theme_minimal()
```


# **Parcelles en propriété**

```{r}
# Étape 1 : Ajouter les libellés + joindre les infos régionales
occupation_data <- s16a %>%
  rename(mode_occupation = s16aq10) %>%
  left_join(s00, by = c("grappe", "menage")) %>%
  filter(!is.na(mode_occupation)) %>%
  mutate(
    region = as.character(region),
    mode_occupation = recode(as.character(mode_occupation), 
                             "1" = "Propriétaire",
                             "2" = "Prêt gratuit",
                             "3" = "Fermage",
                             "4" = "Métayage",
                             "5" = "Gage",
                             "6" = "Autre")
  )

# Étape 2 : Compter le total de parcelles  en propriété
occupation_pourcentage <- occupation_data %>%
  group_by(region, mode_occupation) %>%
  summarise(nb = n(), .groups = "drop") %>%
  group_by(region) %>%
  mutate(total_region = sum(nb)) %>%
  filter(mode_occupation == "Propriétaire") %>%
  mutate(pourcentage = round((nb / total_region) * 100, 1)) %>%
  left_join(correspondance, by = "region")


ggplot(occupation_pourcentage, aes(x = reorder(NOMREG, pourcentage), y = pourcentage)) +
  geom_col(fill = "darkgreen") +
  geom_text(aes(label = paste0(pourcentage, "%")), hjust = -0.1, size = 3) +
  coord_flip() +
  labs(title = "Part des parcelles en propriété par région",
       x = "Région", y = "Pourcentage") +
  theme_minimal()
```


# **Visualisation des activités pastorales**
##Objectif

    Analyser la taille et la répartition du cheptel  

    Étudier le statut de possession du bétail 



# **Carte du cheptel**

```{r}
tm_shape(map_data) +
  tm_polygons("total_animaux", palette = "Blues", title = "Cheptel") +
  tm_text("label_cheptel", size = 0.6, col = "black") +
  tm_title("Distribution du cheptel par région") +
  tm_layout(legend.outside = TRUE)
```

# **Taille moyenne du cheptel par ménage**

```{r}
cat("La moyenne nationale du nombre d'animaux\n par ménage est de", 
    round(mean(merged_geo$nb_animaux, na.rm = TRUE), 2), "animaux.\n")

moyenne_cheptel_region <- merged_geo %>%
  group_by(region) %>%
  summarise(moyenne_cheptel = mean(nb_animaux, na.rm = TRUE)) %>%
  mutate(region = as.character(region)) %>%
  left_join(correspondance, by = "region")

ggplot(moyenne_cheptel_region, aes(x = reorder(NOMREG, moyenne_cheptel), y = moyenne_cheptel)) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = round(moyenne_cheptel, 1)), vjust = -0.0, size = 3) +
  coord_flip() +
  labs(title = "Taille moyenne du cheptel par ménage",
       x = "Région", y = "Nombre moyen d’animaux") +
  theme_minimal()

```


# **Part des ménages éleveurs**

```{r}
#1 Charger les données élevage + localisation
elevage_menages <- s17 %>%
  select(grappe, menage, nb_propres = s17q06) %>%  # ou renomme selon ton nom réel
  left_join(s00, by = c("grappe", "menage")) %>%
  filter(!is.na(nb_propres)) %>%
  mutate(region = as.character(region))

  #2 Tous les ménages ayant renseigné une activité d’élevage
menages_elevage <- elevage_menages %>%
  distinct(region, grappe, menage)

  #3 Ménages éleveurs : ceux ayant déclaré au moins une espèce avec animaux propres > 0
menages_eleveurs <- elevage_menages %>%
  filter(nb_propres > 0) %>%
  distinct(region, grappe, menage)

  #4 : Calcul des effectifs + pourcentage
elevage_par_region <- menages_elevage %>%
  group_by(region) %>%
  summarise(total_menages = n()) %>%
  left_join(
    menages_eleveurs %>%
      group_by(region) %>%
      summarise(nb_eleveurs = n()),
    by = "region"
  ) %>%
  mutate(
    nb_eleveurs = replace_na(nb_eleveurs, 0),
    pourcentage = round((nb_eleveurs / total_menages) * 100, 1)
  ) %>%
  left_join(correspondance, by = "region")

ggplot(elevage_par_region, aes(x = reorder(NOMREG, pourcentage), y = pourcentage)) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = paste0(pourcentage, "%")), hjust = -0.1, size = 3) +
  coord_flip() +
  labs(title = "Part des ménages éleveurs par région",
       x = "Région", y = "Pourcentage de ménages") +
  theme_minimal()

```

# **Activités agricoles et pastorales par milieu**

```{r compar-milieu}
moyennes_milieu <- merged_geo %>%
  mutate(milieu = as_factor(milieu)) %>%
  group_by(milieu) %>%
  summarise(
    moyenne_parcelles = mean(nb_parcelles, na.rm = TRUE),
    moyenne_cheptel = mean(nb_animaux, na.rm = TRUE),
    .groups = "drop"
  )

moyennes_long <- moyennes_milieu %>%
  pivot_longer(cols = c(moyenne_parcelles, moyenne_cheptel),
               names_to = "variable", values_to = "valeur")

# Graphique 1 : Moyenne de parcelles par milieu

p1 <- ggplot(moyennes_milieu, aes(x = milieu, y = moyenne_parcelles, fill = milieu)) +
  geom_col() +
  geom_text(aes(label = round(moyenne_parcelles, 1)), vjust = -0.3, size = 3) +
  labs(title = "Nombre moyen parcelles/ ménage ",
       x = "Milieu", y = "Nombre moyen") +
  theme_minimal() +
  theme(legend.position = "none")

# Graphique 2 : Moyenne de cheptel par milieu
p2 <- ggplot(moyennes_milieu, aes(x = milieu, y = moyenne_cheptel, fill = milieu)) +
  geom_col() +
  geom_text(aes(label = round(moyenne_cheptel, 1)), vjust = -0.3, size = 3) +
  labs(title = "taille moyenne Cheptel/ ménage ",
       x = "Milieu", y = "taille moyenne") +
  theme_minimal() +
  theme(legend.position = "none")

# Afficher côte à côte
p1 + p2

```


# **Conclusion**

    Des disparités régionales marquées dans les activités  
    agricoles et pastorales    

    Des régions comme Kaolack (agriculture) ou Louga (élevage)  
    dominent leur secteur    

    Les milieux ruraux sont bien plus actifs que les milieux  
    urbains    

    


**Merci de votre attention**  

    
    
    